{
    "bug_id": 39,
    "test_id": 0,
    "test_name": "org.apache.commons.lang3.StringUtilsTest.testReplace_StringStringArrayStringArray",
    "test_body": "public void testReplace_StringStringArrayStringArray() {\n//JAVADOC TESTS START\nassertNull(StringUtils.replaceEach(null, new String[]{\"a\"}, new String[]{\"b\"}));\nassertEquals(StringUtils.replaceEach(\"\", new String[]{\"a\"}, new String[]{\"b\"}),\"\");\nassertEquals(StringUtils.replaceEach(\"aba\", null, null),\"aba\");\nassertEquals(StringUtils.replaceEach(\"aba\", new String[0], null),\"aba\");\nassertEquals(StringUtils.replaceEach(\"aba\", null, new String[0]),\"aba\");\nassertEquals(StringUtils.replaceEach(\"aba\", new String[]{\"a\"}, null),\"aba\");\nassertEquals(StringUtils.replaceEach(\"aba\", new String[]{\"a\"}, new String[]{\"\"}),\"b\");\nassertEquals(StringUtils.replaceEach(\"aba\", new String[]{null}, new String[]{\"a\"}),\"aba\");\nassertEquals(StringUtils.replaceEach(\"abcde\", new String[]{\"ab\", \"d\"}, new String[]{\"w\", \"t\"}),\"wcte\");\nassertEquals(StringUtils.replaceEach(\"abcde\", new String[]{\"ab\", \"d\"}, new String[]{\"d\", \"t\"}),\"dcte\");\n//JAVADOC TESTS END\nassertEquals(\"bcc\", StringUtils.replaceEach(\"abc\", new String[]{\"a\", \"b\"}, new String[]{\"b\", \"c\"}));\nassertEquals(\"q651.506bera\", StringUtils.replaceEach(\"d216.102oren\",\nnew String[]{\"a\", \"b\", \"c\", \"d\", \"e\", \"f\", \"g\", \"h\", \"i\", \"j\", \"k\", \"l\", \"m\", \"n\", \n\"o\", \"p\", \"q\", \"r\", \"s\", \"t\", \"u\", \"v\", \"w\", \"x\", \"y\", \"z\", \"A\", \"B\", \"C\", \"D\", \n\"E\", \"F\", \"G\", \"H\", \"I\", \"J\", \"K\", \"L\", \"M\", \"N\", \"O\", \"P\", \"Q\", \"R\", \"S\", \"T\", \n\"U\", \"V\", \"W\", \"X\", \"Y\", \"Z\", \"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\", \"8\", \"9\"},\nnew String[]{\"n\", \"o\", \"p\", \"q\", \"r\", \"s\", \"t\", \"u\", \"v\", \"w\", \"x\", \"y\", \"z\", \"a\", \n\"b\", \"c\", \"d\", \"e\", \"f\", \"g\", \"h\", \"i\", \"j\", \"k\", \"l\", \"m\", \"N\", \"O\", \"P\", \"Q\", \n\"R\", \"S\", \"T\", \"U\", \"V\", \"W\", \"X\", \"Y\", \"Z\", \"A\", \"B\", \"C\", \"D\", \"E\", \"F\", \"G\", \n\"H\", \"I\", \"J\", \"K\", \"L\", \"M\", \"5\", \"6\", \"7\", \"8\", \"9\", \"1\", \"2\", \"3\", \"4\"}));\n// Test null safety inside arrays - LANG-552\nassertEquals(StringUtils.replaceEach(\"aba\", new String[]{\"a\"}, new String[]{null}),\"aba\");\nassertEquals(StringUtils.replaceEach(\"aba\", new String[]{\"a\", \"b\"}, new String[]{\"c\", null}),\"cbc\");\n}\n",
    "stack_trace": "java.lang.NullPointerException\nat org.apache.commons.lang3.StringUtils.replaceEach(StringUtils.java:3676)\nat org.apache.commons.lang3.StringUtils.replaceEach(StringUtils.java:3502)\nat org.apache.commons.lang3.StringUtilsTest.testReplace_StringStringArrayStringArray(StringUtilsTest.java:1039)",
    "covered_methods": [
        {
            "method_signature": "org.apache.commons.lang3.StringUtils:replaceEach(Ljava/lang/String;[Ljava/lang/String;[Ljava/lang/String;ZI)Ljava/lang/String;",
            "method_body": "private static String replaceEach(String text, String[] searchList, String[] replacementList,\nboolean repeat, int timeToLive)\n{\n\n// mchyzer Performance note: This creates very few new objects (one major goal)\n// let me know if there are performance requests, we can create a harness to measure\n\nif (text == null || text.length() == 0 || searchList == null ||\nsearchList.length == 0 || replacementList == null || replacementList.length == 0)\n{\nreturn text;\n}\n\n// if recursing, this shouldnt be less than 0\nif (timeToLive < 0) {\nthrow new IllegalStateException(\"TimeToLive of \" + timeToLive + \" is less than 0: \" + text);\n}\n\nint searchLength = searchList.length;\nint replacementLength = replacementList.length;\n\n// make sure lengths are ok, these need to be equal\nif (searchLength != replacementLength) {\nthrow new IllegalArgumentException(\"Search and Replace array lengths don't match: \"\n+ searchLength\n+ \" vs \"\n+ replacementLength);\n}\n\n// keep track of which still have matches\nboolean[] noMoreMatchesForReplIndex = new boolean[searchLength];\n\n// index on index that the match was found\nint textIndex = -1;\nint replaceIndex = -1;\nint tempIndex = -1;\n\n// index of replace array that will replace the search string found\n// NOTE: logic duplicated below START\nfor (int i = 0; i < searchLength; i++) {\nif (noMoreMatchesForReplIndex[i] || searchList[i] == null ||\nsearchList[i].length() == 0 || replacementList[i] == null)\n{\ncontinue;\n}\ntempIndex = text.indexOf(searchList[i]);\n\n// see if we need to keep searching for this\nif (tempIndex == -1) {\nnoMoreMatchesForReplIndex[i] = true;\n} else {\nif (textIndex == -1 || tempIndex < textIndex) {\ntextIndex = tempIndex;\nreplaceIndex = i;\n}\n}\n}\n// NOTE: logic mostly below END\n\n// no search strings found, we are done\nif (textIndex == -1) {\nreturn text;\n}\n\nint start = 0;\n\n// get a good guess on the size of the result buffer so it doesnt have to double if it goes over a bit\nint increase = 0;\n\n// count the replacement text elements that are larger than their corresponding text being replaced\nfor (int i = 0; i < searchList.length; i++) {\nint greater = replacementList[i].length() - searchList[i].length();\nif (greater > 0) {\nincrease += 3 * greater; // assume 3 matches\n}\n}\n// have upper-bound at 20% increase, then let Java take over\nincrease = Math.min(increase, text.length() / 5);\n\nStringBuilder buf = new StringBuilder(text.length() + increase);\n\nwhile (textIndex != -1) {\n\nfor (int i = start; i < textIndex; i++) {\nbuf.append(text.charAt(i));\n}\nbuf.append(replacementList[replaceIndex]);\n\nstart = textIndex + searchList[replaceIndex].length();\n\ntextIndex = -1;\nreplaceIndex = -1;\ntempIndex = -1;\n// find the next earliest match\n// NOTE: logic mostly duplicated above START\nfor (int i = 0; i < searchLength; i++) {\nif (noMoreMatchesForReplIndex[i] || searchList[i] == null ||\nsearchList[i].length() == 0 || replacementList[i] == null)\n{\ncontinue;\n}\ntempIndex = text.indexOf(searchList[i], start);\n\n// see if we need to keep searching for this\nif (tempIndex == -1) {\nnoMoreMatchesForReplIndex[i] = true;\n} else {\nif (textIndex == -1 || tempIndex < textIndex) {\ntextIndex = tempIndex;\nreplaceIndex = i;\n}\n}\n}\n// NOTE: logic duplicated above END\n\n}\nint textLength = text.length();\nfor (int i = start; i < textLength; i++) {\nbuf.append(text.charAt(i));\n}\nString result = buf.toString();\nif (!repeat) {\nreturn result;\n}\n\nreturn replaceEach(result, searchList, replacementList, repeat, timeToLive - 1);\n}",
            "method_id": 0
        },
        {
            "method_signature": "org.apache.commons.lang3.StringUtils:replaceEach(Ljava/lang/String;[Ljava/lang/String;[Ljava/lang/String;)Ljava/lang/String;",
            "method_body": "public static String replaceEach(String text, String[] searchList, String[] replacementList) {\nreturn replaceEach(text, searchList, replacementList, false, 0);\n}",
            "method_id": 1
        }
    ]
}